<div id="ffPing" style="position:fixed;top:10px;right:10px;background:rgba(0,0,0,0.6);color:white;padding:6px 12px;border-radius:8px;font-family:sans-serif;font-weight:700;">
  Ping: <span id="pingValue">--</span> ms
  <span id="pingBars" style="margin-left:6px;"></span>
</div>

<script>
function updateFFPing() {
  // Simulate a ping value (or replace with real measurement)
  const ping = Math.floor(Math.random() * 200) + 20; // 20ms to 220ms
  document.getElementById('pingValue').textContent = ping;

  const bars = document.getElementById('pingBars');
  bars.innerHTML = '';
  let color = 'green';
  if (ping > 100 && ping <= 150) color = 'yellow';
  else if (ping > 150) color = 'red';

  const barCount = 4; // max bars
  let filled = 1;
  if (ping <= 50) filled = 4;
  else if (ping <= 100) filled = 3;
  else if (ping <= 150) filled = 2;
  else filled = 1;

  for (let i = 0; i < barCount; i++) {
    const span = document.createElement('span');
    span.style.display = 'inline-block';
    span.style.width = '4px';
    span.style.height = `${6 + i*4}px`;
    span.style.marginRight = '2px';
    span.style.background = i < filled ? color : 'rgba(255,255,255,0.3)';
    span.style.borderRadius = '2px';
    bars.appendChild(span);
  }
}

// Update every 1 second
setInterval(updateFFPing, 1000);
updateFFPing();
</script>


<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Namaste India ‚Äî QR Generator & File Scanner</title>
<link rel="icon" href="data:,">
<style>
:root{
  --accent:#ff4081;
  --card-radius:16px;
  --glass: rgba(255,255,255,0.6);
}
body{
  margin:0;
  font-family: "Segoe UI", Roboto, Arial, sans-serif;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  background: linear-gradient(135deg,#fdfbfb,#ebedee);
  color:#222;
  transition:background .35s, color .35s;
}
body.dark{
  background: linear-gradient(135deg,#0f1724,#122233);
  color:#e6eef8;
}
header{
  width:100%;
  padding:14px 18px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  max-width:1100px;
  box-sizing:border-box;
}
.brand{
  display:flex;
  gap:12px;
  align-items:center;
  font-weight:700;
  font-size:20px;
}
.brand .emoji{ font-size:22px; transform: translateY(1px); }
.mode-switch{
  background:transparent;
  border:1px solid rgba(0,0,0,0.08);
  padding:8px 12px;
  border-radius:999px;
  cursor:pointer;
  display:inline-flex;
  gap:8px;
  align-items:center;
}
body.dark .mode-switch{ border-color: rgba(255,255,255,0.15); }
.wrap{
  width:100%;
  max-width:1100px;
  display:grid;
  grid-template-columns: 1fr 420px;
  gap:18px;
  padding:18px;
  box-sizing:border-box;
}
@media (max-width:920px){ .wrap{ grid-template-columns: 1fr; } }
.card{
  background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.72));
  border-radius:var(--card-radius);
  padding:18px;
  box-shadow: 0 8px 30px rgba(14,30,37,0.07);
  transition: background .3s, box-shadow .3s;
}
body.dark .card{
  background: linear-gradient(180deg, rgba(8,12,20,0.65), rgba(12,18,28,0.5));
  box-shadow: 0 8px 30px rgba(2,6,12,0.6);
}
h1,h2{ margin:8px 0; }
h1{ font-family: "Cursive", Georgia; color:var(--accent); text-shadow: 1px 1px 6px rgba(0,0,0,0.12); }
body.dark h1{ color:#ffd6e6; text-shadow: 1px 1px 6px rgba(0,0,0,0.35); }
.controls { display:flex; flex-direction:column; align-items:center; gap:8px; }
select,input[type=text], button, input[type=password]{
  width:92%;
  max-width:360px;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid #d6d6d6;
  font-size:15px;
  outline:none;
}
body.dark select,input[type=text], input[type=password]{ border-color:#394a5a; background:#0f2130; color:#e6eef8; }
button.primary{ background: linear-gradient(135deg,#ff8a65,#ff4081); color:white; border:none; cursor:pointer; font-weight:700; }
button.ghost{ background:transparent; border:1px solid rgba(0,0,0,0.08); }
.logos{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:8px; }
.logos img{ width:46px; height:46px; object-fit:cover; border-radius:10px; cursor:pointer; border:2px solid transparent; transition:transform .15s, border-color .15s; }
.logos img:hover{ transform:scale(1.06); }
.logos img.selected{ border-color:var(--accent); transform:scale(1.03); }
.qrcanvas-wrap{ text-align:center; margin-top:10px; }
#qrcodeCanvas{ width:300px; height:300px; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.08); background:white; }
#scannerCard .muted{ color: #6b7280; font-size:14px; }
body.dark #scannerCard .muted{ color:#9fb0c8; }
.file-row{ display:flex; gap:8px; align-items:center; justify-content:center; margin-top:8px; flex-wrap:wrap; }
.file-row label{ cursor:pointer; border-radius:10px; padding:10px 14px; background: linear-gradient(135deg,#00c6ff,#0072ff); color:white; font-weight:700; }
#scan-result{ font-weight:700; color:var(--accent); margin-top:12px; word-break:break-word; }
footer{
  width:100%;
  margin-top:24px;
  padding:18px;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:12px;
  background: linear-gradient(90deg,#ff6ec4,#7873f5);
  color:white;
  border-top-left-radius:18px;
  border-top-right-radius:18px;
  box-shadow: 0 -6px 30px rgba(120,115,245,0.12);
}
.fancy-name{
  background: linear-gradient(90deg,#fff,#ffd6e6,#fff);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  font-family:'Cursive';
  font-size:20px;
  text-shadow: 0 2px 8px rgba(0,0,0,0.15);
}
.small{ font-size:13px; color:#6b7280; }
body.dark .small{ color:#9fb0c8; }
</style>
</head>
<body>

<header>
  <div class="brand">
    <span class="emoji">üå∏</span>
    <div>
      <div style="font-size:14px;opacity:.9">Namaste India</div>
      <div style="font-size:12px;opacity:.7">QR Tools ‚Äî Generator & File Scanner</div>
    </div>
  </div>
  <button class="mode-switch" id="modeBtn" title="Toggle light / dark">
    <span id="modeIcon">üåó</span>
    <span style="font-weight:700">Mode</span>
  </button>
</header>

<div class="wrap">
  <!-- LEFT: QR generator -->
  <div class="card">
    <h1>üå∫ Namaste India</h1>
    <div class="controls">
      <h2>üé® QR Generator</h2>
      <select id="type">
        <option value="text">Text</option>
        <option value="url">Link / URL</option>
        <option value="wifi">WiFi (SSID,WPA,password)</option>
        <option value="phone">Phone Number</option>
        <option value="whatsapp">WhatsApp (country+number)</option>
      </select>
      <input id="data" type="text" placeholder="Enter text / link / phone / wifi..." />
      <label style="width:92%;max-width:360px;text-align:left;margin-top:6px">Gradient preset</label>
      <select id="gradientPreset" style="width:92%;max-width:360px">
        <option value="#ff5722,#4caf50">Orange ‚Üí Green</option>
        <option value="#2196f3,#9c27b0">Blue ‚Üí Purple</option>
        <option value="#f44336,#ffeb3b">Red ‚Üí Yellow</option>
        <option value="#ff0080,#ff8c00">Pink ‚Üí Orange</option>
        <option value="#00bcd4,#8e24aa">Cyan ‚Üí Violet</option>
        <option value="#4caf50,#ffeb3b">Green ‚Üí Yellow</option>
        <option value="#ff5722,#9c27b0">Orange ‚Üí Purple</option>
      </select>
      <div style="display:flex;gap:10px;width:92%;max-width:360px;margin-top:10px">
        <button class="primary" onclick="generateQR()" style="flex:1">Generate</button>
        <button class="ghost" onclick="downloadPNG()" style="flex:1">Download</button>
      </div>
      <div class="qrcanvas-wrap">
        <canvas id="qrcodeCanvas" width="300" height="300"></canvas>
        <div class="small">Tap & hold the image to save (mobile) or use Download button.</div>
      </div>
    </div>
  </div>

  <!-- RIGHT: QR scanner -->
  <div id="scannerCard" class="card">
    <h2>üìÇ QR Scanner</h2>
    <div class="small">Choose a QR image (PNG/JPG). Decoded result will appear below.</div>
    <div class="file-row">
      <label for="fileInput">üìÅ Upload QR image</label>
      <input id="fileInput" type="file" accept="image/*" style="display:none">
    </div>
    <div id="scan-result">No QR scanned yet</div>
  </div>

  <!-- Adult section -->
  <div class="card">
    <h2>üîû #Study material (Just an example)</h2>
    <div id="loginSectionAdult">
      <input type="text" id="adultUsername" placeholder="Username">
      <input type="password" id="adultPassword" placeholder="Password">
      <button class="primary" id="adultLoginBtn">Enter</button>
      <p id="adultLoginMsg" style="color:red;"></p>
      <p style="margin-top:8px; font-size:14px;">
        Forgot credentials? 
        <a href="https://wa.me/447877486623?text=Hi,%20I%20need%20the%2018%2B%20username%20and%20password" target="_blank">Click here to get them on WhatsApp</a>
      </p>
    </div>
    <div id="protectedAdultContent" style="display:none;">
      <h3>Welcome to 18+ Section</h3>
      <p>üìÑ Study Material: <a href="https://drive.google.com/file/d/16guYnuJDX2ZpdE-La50Ej_5vYZHFEcTy/view?usp=drivesdk" target="_blank">Click to open</a></p>
    </div>
  </div>
</div>

<footer>
  <div>Contact Developer ‚Äî <span class="fancy-name">_a.a.r.i.z07_</span></div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
<script>
// Theme toggle
const body = document.body;
const modeBtn = document.getElementById('modeBtn');
const modeIcon = document.getElementById('modeIcon');
(function(){
  if(localStorage.getItem('ni_mode')==='dark'){ body.classList.add('dark'); modeIcon.textContent='üåô'; }
})();
modeBtn.addEventListener('click', ()=>{
  body.classList.toggle('dark');
  localStorage.setItem('ni_mode', body.classList.contains('dark')?'dark':'light');
  modeIcon.textContent = body.classList.contains('dark')?'üåô':'üåó';
});

// QR generator
function generateQR(){
  const type = document.getElementById('type').value;
  let data = document.getElementById('data').value.trim();
  if(!data){ alert('Please enter data'); return; }
  if(type==='wifi'){
    const parts = data.split(',');
    if(parts.length!==3){ alert('WiFi format: SSID,WPA,password'); return; }
    data = `WIFI:S:${parts[0]};T:${parts[1]};P:${parts[2]};;`;
  } else if(type==='phone'){ data = `tel:${data}`; }
  else if(type==='whatsapp'){ data = `https://wa.me/${data.replace(/\D/g,'')}`; }

  QRCode.toCanvas(document.getElementById('qrcodeCanvas'), data, { width:300, margin:1 }, function(err){
    if(err) alert(err);
  });
}
function downloadPNG(){
  const canvas = document.getElementById('qrcodeCanvas');
  const a = document.createElement('a');
  a.href = canvas.toDataURL("image/png");
  a.download = "namaste_qr.png";
  a.click();
}

// QR Scanner
const fileInput = document.getElementById('fileInput');
fileInput.addEventListener('change', e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(){
    const img = new Image();
    img.onload = function(){
      const canvas = document.createElement('canvas');
      canvas.width = img.width; canvas.height = img.height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img,0,0);
      const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
      const code = jsQR(imageData.data, canvas.width, canvas.height);
      document.getElementById('scan-result').textContent = code ? code.data : "No QR code detected!";
      if(code) document.getElementById('data').value = code.data;
    };
    img.src = reader.result;
  };
  reader.readAsDataURL(file);
});

// 18+ content
const adultLoginBtn = document.getElementById('adultLoginBtn');
const adultUsername = document.getElementById('adultUsername');
const adultPassword = document.getElementById('adultPassword');
const adultLoginMsg = document.getElementById('adultLoginMsg');
const protectedAdultContent = document.getElementById('protectedAdultContent');
const adultCorrectUsername = "user18";
const adultCorrectPassword = "pass18";

adultLoginBtn.addEventListener('click', ()=>{
  if(adultUsername.value === adultCorrectUsername && adultPassword.value === adultCorrectPassword){
    adultLoginMsg.textContent = "";
    document.getElementById('loginSectionAdult').style.display='none';
    protectedAdultContent.style.display='block';
  } else {
    adultLoginMsg.textContent = "Incorrect username or password!";
  }
});
</script>

</body>
</html>
<section class="services">
  <!-- Your existing service cards -->
</section>

<!-- Get Your Website Section -->
<section style="background:#ff4081; color:white; text-align:center; padding:60px 20px; border-radius:12px; margin:40px 20px;">
  <h2 style="font-size:2rem; margin-bottom:10px;">Get Your Own Website in 24‚Äì36 Hours</h2>
  <p style="font-size:1.1rem; margin-bottom:20px;">
    Price Range: <strong>‚Çπ0 - ‚Çπ100</strong>
  </p>
  <p style="font-size:1.1rem; margin-bottom:30px;">
    Message us now and we will create a fully functional, professional website for you quickly and easily!
  </p>
  <div style="display:flex; justify-content:center; gap:20px; flex-wrap:wrap;">
    <a href=" target="_blank" 
       style="background:white; color:#ff4081; text-decoration:none; padding:15px 30px; border-radius:8px; font-weight:bold; font-size:1rem;">
      Telegram
    </a>
    <a href="https://wa.me/447877486623" target="_blank"
       style="background:white; color:#ff4081; text-decoration:none; padding:15px 30px; border-radius:8px; font-weight:bold; font-size:1rem;">
      WhatsApp
    </a>
  </div>
</section>
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Voice Booster</title>
<style>
  :root{ --accent:#ff4081; --bg:#0f1724; --card:#0b1220; --text:#e6eef8; }
  body{ margin:0; font-family:Inter,system-ui,Arial; background:linear-gradient(180deg,#071026,#0b1220); color:var(--text); min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px;}
  .card{width:100%;max-width:760px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); padding:22px;border-radius:12px; box-shadow:0 8px 30px rgba(2,6,23,0.6); }
  h1{margin:0 0 8px;font-size:20px}
  p.lead{margin:0 0 18px; color:#bcd3ee;font-size:13px}
  .controls{display:grid; grid-template-columns: 1fr 1fr; gap:12px; align-items:center; margin-bottom:16px}
  .full{grid-column:1/-1}
  label{font-size:12px;color:#b8d0f0; display:block; margin-bottom:6px}
  input[type="range"]{width:100%}
  .btn-row{display:flex; gap:8px}
  button{background:var(--accent); color:#fff; border:none; padding:10px 14px; border-radius:8px; font-weight:600; cursor:pointer;}
  button.secondary{background:transparent; border:1px solid rgba(255,255,255,0.08);}
  .meter{height:10px;border-radius:6px;background:rgba(255,255,255,0.06); overflow:hidden}
  .meter > i{display:block;height:100%; width:0%; background:linear-gradient(90deg,#00f,#0ff); border-radius:6px}
  small.warn{display:block;margin-top:10px;color:#ffd1d1}
  footer{margin-top:16px;color:#96b5dd;font-size:12px}
  .row{display:flex; gap:8px; align-items:center}
  @media(max-width:560px){ .controls{grid-template-columns:1fr} }
</style>
</head>
<<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Voice Booster + Recorder</title>
<style>
  body{margin:0;font-family:sans-serif;background:#0d1117;color:#eee;display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px}
  .card{background:#161b22;padding:20px;border-radius:12px;max-width:800px;width:100%;box-shadow:0 6px 20px rgba(0,0,0,0.5)}
  h1{margin-top:0;text-align:center}
  label{display:block;margin-top:12px;font-size:14px}
  input[type=range]{width:100%}
  .controls{margin:10px 0}
  button{margin:8px 5px;padding:10px 15px;border:none;border-radius:6px;font-weight:bold;cursor:pointer}
  button.primary{background:#ff4081;color:#fff}
  button.secondary{background:#30363d;color:#fff}
  .meter{height:10px;background:#333;border-radius:6px;margin-top:10px;overflow:hidden}
  .meter > div{height:100%;width:0%;background:linear-gradient(90deg,#0ff,#0f0)}
  footer{text-align:center;font-size:13px;margin-top:10px;color:#aaa}
</style>
</head>
<body>
<div class="card">
  <h1>üé§ Voice Booster + Recorder</h1>

  <div class="controls">
    <label>Gain: <span id="gainVal">1.0</span>√ó</label>
    <input type="range" id="gain" min="0" max="5" step="0.1" value="1">

    <label>Bass: <span id="bassVal">0</span> dB</label>
    <input type="range" id="bass" min="-15" max="15" step="1" value="0">

    <label>Treble: <span id="trebleVal">0</span> dB</label>
    <input type="range" id="treble" min="-15" max="15" step="1" value="0">

    <label>Output Volume: <span id="volVal">1.0</span>√ó</label>
    <input type="range" id="volume" min="0" max="2" step="0.1" value="1">

    <div class="meter"><div id="meterFill"></div></div>
  </div>

  <div class="controls">
    <button class="primary" id="startBtn">Start Mic</button>
    <button class="secondary" id="stopBtn" disabled>Stop</button>
    <button class="secondary" id="recBtn" disabled>Start Recording</button>
    <button class="secondary" id="downloadBtn" disabled>Download</button>
  </div>

  <footer>‚ö†Ô∏è Use headphones. Adjust gain/bass/treble slowly to avoid distortion.</footer>
</div>

<script>
let audioCtx, micStream, sourceNode, lowShelf, highShelf, gainNode, outputGain, analyser;
let recorder, recordedChunks = [];
let isRecording = false;
let rafId;

const gainSlider = document.getElementById("gain");
const bassSlider = document.getElementById("bass");
const trebleSlider = document.getElementById("treble");
const volumeSlider = document.getElementById("volume");
const meterFill = document.getElementById("meterFill");

const gainVal = document.getElementById("gainVal");
const bassVal = document.getElementById("bassVal");
const trebleVal = document.getElementById("trebleVal");
const volVal = document.getElementById("volVal");

const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const recBtn = document.getElementById("recBtn");
const downloadBtn = document.getElementById("downloadBtn");

async function startAudio() {
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  micStream = await navigator.mediaDevices.getUserMedia({ audio: true });
  sourceNode = audioCtx.createMediaStreamSource(micStream);

  // filters
  lowShelf = audioCtx.createBiquadFilter();
  lowShelf.type = "lowshelf";
  lowShelf.frequency.value = 150;

  highShelf = audioCtx.createBiquadFilter();
  highShelf.type = "highshelf";
  highShelf.frequency.value = 3000;

  gainNode = audioCtx.createGain();
  outputGain = audioCtx.createGain();

  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 512;

  sourceNode.connect(lowShelf);
  lowShelf.connect(highShelf);
  highShelf.connect(gainNode);
  gainNode.connect(outputGain);
  outputGain.connect(analyser);
  analyser.connect(audioCtx.destination);

  updateValues();
  updateMeter();

  // recorder setup
  const dest = audioCtx.createMediaStreamDestination();
  outputGain.connect(dest);
  recorder = new MediaRecorder(dest.stream);
  recorder.ondataavailable = e => recordedChunks.push(e.data);
  recorder.onstop = saveRecording;

  startBtn.disabled = true;
  stopBtn.disabled = false;
  recBtn.disabled = false;
}

function stopAudio() {
  if (rafId) cancelAnimationFrame(rafId);
  if (micStream) micStream.getTracks().forEach(t => t.stop());
  if (audioCtx) audioCtx.close();
  startBtn.disabled = false;
  stopBtn.disabled = true;
  recBtn.disabled = true;
}

function updateValues() {
  gainNode.gain.value = parseFloat(gainSlider.value);
  outputGain.gain.value = parseFloat(volumeSlider.value);
  lowShelf.gain.value = parseFloat(bassSlider.value);
  highShelf.gain.value = parseFloat(trebleSlider.value);

  gainVal.textContent = gainSlider.value;
  bassVal.textContent = bassSlider.value;
  trebleVal.textContent = trebleSlider.value;
  volVal.textContent = volumeSlider.value;
}

function updateMeter() {
  const buf = new Uint8Array(analyser.fftSize);
  analyser.getByteTimeDomainData(buf);
  let sum = 0;
  for (let i = 0; i < buf.length; i++) {
    let v = (buf[i] - 128) / 128;
    sum += v * v;
  }
  let rms = Math.sqrt(sum / buf.length);
  let pct = Math.min(1, rms * 3);
  meterFill.style.width = (pct * 100) + "%";
  rafId = requestAnimationFrame(updateMeter);
}

function toggleRecord() {
  if (!isRecording) {
    recordedChunks = [];
    recorder.start();
    recBtn.textContent = "Stop Recording";
    isRecording = true;
  } else {
    recorder.stop();
    recBtn.textContent = "Start Recording";
    isRecording = false;
  }
}

function saveRecording() {
  const blob = new Blob(recordedChunks, { type: "audio/webm" });
  const url = URL.createObjectURL(blob);
  downloadBtn.href = url;
  downloadBtn.download = "recorded-voice.webm";
  downloadBtn.disabled = false;
}

gainSlider.oninput = updateValues;
bassSlider.oninput = updateValues;
trebleSlider.oninput = updateValues;
volumeSlider.oninput = updateValues;

startBtn.onclick = startAudio;
stopBtn.onclick = stopAudio;
recBtn.onclick = toggleRecord;
</script>
</body>
</html>
  // Connect: source -> low -> high -> gain -> analyser -> output
  sourceNode.connect(lowShelf);
  lowShelf.connect(highShelf);
  highShelf.connect(gainNode);
  gainNode.connect(analyser);
  analyser.connect(outputGain);
  outputGain.connect(audioCtx.destination);

  // Set initial values
  gainNode.gain.value = parseFloat(gainSlider.value);
  outputGain.gain.value = parseFloat(outputSlider.value);
  lowShelf.gain.value = parseFloat(bassSlider.value);
  highShelf.gain.value = parseFloat(trebleSlider.value);
  isMuted = false;
  muteBtn.textContent = 'Mute: OFF';

  // start meter
  updateMeter();
}

function stopAudio(){
  if(rafId) { cancelAnimationFrame(rafId); rafId = null; }
  if(analyser){ analyser.disconnect(); analyser = null; }
  if(gainNode){ gainNode.disconnect(); gainNode = null; }
  if(highShelf){ highShelf.disconnect(); highShelf = null; }
  if(lowShelf){ lowShelf.disconnect(); lowShelf = null; }
  if(sourceNode){ sourceNode.disconnect(); sourceNode = null; }
  if(outputGain){ outputGain.disconnect(); outputGain = null; }
  if(audioCtx){ try{ audioCtx.close(); }catch(e){} audioCtx = null; }
  if(micStream){
    micStream.getTracks().forEach(t=>t.stop());
    micStream = null;
  }
  meterFill.style.width = '0%';
}

function updateMeter(){
  if(!analyser) return;
  const buf = new Uint8Array(analyser.fftSize);
  analyser.getByteTimeDomainData(buf);
  // compute RMS-ish level
  let sum = 0;
  for(let i=0;i<buf.length;i++){
    const v = (buf[i] - 128)/128;
    sum += v*v;
  }
  const rms = Math.sqrt(sum / buf.length);
  const pct = Math.min(1, rms*3); // scale for visual
  meterFill.style.width = (pct*100) + '%';
  rafId = requestAnimationFrame(updateMeter);
}

// UI events
startBtn.addEventListener('click', async ()=>{
  if(audioCtx) return; // already started
  try{
    const stream = await navigator.mediaDevices.getUserMedia({ audio: { echoCancellation:true, noiseSuppression:true }, video:false });
    createAudioGraph(stream);
    stopBtn.disabled = false;
    startBtn.disabled = true;
  }catch(err){
    alert('Microphone access required. Error: ' + (err.message || err));
  }
});

stopBtn.addEventListener('click', ()=>{
  stopAudio();
  stopBtn.disabled = true;
  startBtn.disabled = false;
});

resetBtn.addEventListener('click', ()=>{
  gainSlider.value = 1; gainVal.textContent = '1.0';
  outputSlider.value = 1; volVal.textContent = '1.0';
  bassSlider.value = 0; bassVal.textContent = '0';
  trebleSlider.value = 0; trebVal.textContent = '0';
  if(gainNode) gainNode.gain.value = 1;
  if(outputGain) outputGain.gain.value = 1;
  if(lowShelf) lowShelf.gain.value = 0;
  if(highShelf) highShelf.gain.value = 0;
});

muteBtn.addEventListener('click', ()=>{
  if(!audioCtx) return;
  isMuted = !isMuted;
  if(isMuted){
    if(outputGain) outputGain.gain.value = 0;
    muteBtn.textContent = 'Mute: ON';
  }else{
    outputGain.gain.value = parseFloat(outputSlider.value);
    muteBtn.textContent = 'Mute: OFF';
  }
});

// sliders
gainSlider.addEventListener('input', (e)=>{
  const v = parseFloat(e.target.value);
  gainVal.textContent = v.toFixed(2);
  if(gainNode) gainNode.gain.value = v;
});

outputSlider.addEventListener('input', (e)=>{
  const v = parseFloat(e.target.value);
  volVal.textContent = v.toFixed(2);
  if(outputGain && !isMuted) outputGain.gain.value = v;
});

bassSlider.addEventListener('input', (e)=>{
  const v = parseFloat(e.target.value);
  bassVal.textContent = v.toFixed(1);
  if(lowShelf) lowShelf.gain.value = v;
});

trebleSlider.addEventListener('input', (e)=>{
  const v = parseFloat(e.target.value);
  trebVal.textContent = v.toFixed(1);
  if(highShelf) highShelf.gain.value = v;
});

// safety: stop audio when page unloads
window.addEventListener('pagehide', ()=>{ stopAudio(); });
window.addEventListener('beforeunload', ()=>{ stopAudio(); });

</script>
</body>
</html>
